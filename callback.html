<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HitScan - Callback</title>
</head>
<body>

    <h1>Bedankt voor het inloggen!</h1>
    <p>We halen nu de gegevens op om muziek af te spelen...</p>

    <script>
        window.onload = function() {
            // Haal de token op uit de URL (alles na de '#')
            const hash = window.location.hash.substring(1);  // Verwijder de # uit de URL
            const params = new URLSearchParams(hash);        // Zet de hash om in query parameters

            const accessToken = params.get("access_token"); // Haal de access_token op uit de URL

            if (accessToken) {
                // Bewaar de access token lokaal in localStorage voor later gebruik
                localStorage.setItem("spotifyAccessToken", accessToken);
                console.log("Access Token:", accessToken);

                // Hier kun je verder gaan met het afspelen van muziek (bijv. playSong)
                // playSong(accessToken, "trackID"); // Vervang "trackID" met een echte track ID
            } else {
                console.error("Geen access token gevonden.");
                alert("Er is een probleem met de login. Probeer het opnieuw.");
            }
        };

        // Functie om muziek af te spelen (voorbeeld)
        function playSong(accessToken, trackId) {
            const songData = {
                uris: [`spotify:track:${trackId}`]  // Vervang dit door de track die je wilt afspelen
            };

            const playSongUrl = "https://api.spotify.com/v1/me/player/play";

            fetch(playSongUrl, {
                method: "PUT",
                headers: {
                    "Authorization": `Bearer ${accessToken}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(songData)
            })
            .then(response => {
                if (response.status === 401) {
                    // Als de token is verlopen, geef een melding
                    alert("Je sessie is verlopen. Log opnieuw in.");
                    window.location.href = "https://chantyk.github.io/HitScan/callback.html"; // Of naar login-pagina
                } else {
                    return response.json();
                }
            })
            .then(data => {
                console.log("Nummer wordt afgespeeld:", data);
            })
            .catch(error => {
                console.error("Fout bij afspelen nummer:", error);
            });
        }
    </script>
</body>
</html>
